{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "cascader",
  "type": "registry:component",
  "title": "Cascader",
  "description": "A cascading dropdown menu component for selecting hierarchical data like locations, categories, or organizational structures.",
  "files": [
    {
      "path": "src/components/ui/cascader.tsx",
      "content": "\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport { ChevronRight, ChevronDown, X } from \"lucide-react\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport {\r\n  Popover,\r\n  PopoverContent,\r\n  PopoverTrigger,\r\n} from \"@/components/ui/popover\";\r\n\r\nexport interface CascaderOption {\r\n  value: string;\r\n  label: React.ReactNode;\r\n  textLabel?: string; // Optional string label for display rendering, falls back to value if not provided\r\n  disabled?: boolean;\r\n  children?: CascaderOption[];\r\n}\r\n\r\nexport interface CascaderProps {\r\n  options: CascaderOption[];\r\n  value?: string[];\r\n  defaultValue?: string[];\r\n  onChange?: (value: string[], selectedOptions: CascaderOption[]) => void;\r\n  placeholder?: string;\r\n  disabled?: boolean;\r\n  allowClear?: boolean;\r\n  className?: string;\r\n  popupClassName?: string;\r\n  expandTrigger?: \"click\" | \"hover\";\r\n  displayRender?: (\r\n    labels: string[],\r\n    selectedOptions: CascaderOption[]\r\n  ) => React.ReactNode;\r\n}\r\n\r\nfunction getStringLabel(option: CascaderOption): string {\r\n  if (option.textLabel) return option.textLabel;\r\n  if (typeof option.label === \"string\") return option.label;\r\n  return option.value;\r\n}\r\n\r\nexport function Cascader({\r\n  options,\r\n  value,\r\n  defaultValue,\r\n  onChange,\r\n  placeholder = \"Please select\",\r\n  disabled = false,\r\n  allowClear = true,\r\n  className,\r\n  popupClassName,\r\n  expandTrigger = \"click\",\r\n  displayRender,\r\n}: CascaderProps) {\r\n  const [open, setOpen] = React.useState(false);\r\n  const [internalValue, setInternalValue] = React.useState<string[]>(\r\n    defaultValue || []\r\n  );\r\n  const [expandedPath, setExpandedPath] = React.useState<string[]>([]);\r\n\r\n  const selectedValue = value !== undefined ? value : internalValue;\r\n\r\n  // Get the columns to display based on expanded path\r\n  const getColumns = React.useCallback(() => {\r\n    const columns: CascaderOption[][] = [options];\r\n    let currentOptions = options;\r\n\r\n    for (const val of expandedPath) {\r\n      const found = currentOptions.find((opt) => opt.value === val);\r\n      if (found?.children) {\r\n        columns.push(found.children);\r\n        currentOptions = found.children;\r\n      } else {\r\n        break;\r\n      }\r\n    }\r\n\r\n    return columns;\r\n  }, [options, expandedPath]);\r\n\r\n  // Get selected options chain from value\r\n  const getSelectedOptions = React.useCallback(\r\n    (vals: string[]): CascaderOption[] => {\r\n      const result: CascaderOption[] = [];\r\n      let currentOptions = options;\r\n\r\n      for (const val of vals) {\r\n        const found = currentOptions.find((opt) => opt.value === val);\r\n        if (found) {\r\n          result.push(found);\r\n          currentOptions = found.children || [];\r\n        } else {\r\n          break;\r\n        }\r\n      }\r\n\r\n      return result;\r\n    },\r\n    [options]\r\n  );\r\n\r\n  const selectedOptions = getSelectedOptions(selectedValue);\r\n  const displayLabels = selectedOptions.map((opt) => getStringLabel(opt));\r\n\r\n  const handleSelect = (option: CascaderOption, columnIndex: number) => {\r\n    if (option.disabled) return;\r\n\r\n    const newPath = [...expandedPath.slice(0, columnIndex), option.value];\r\n\r\n    if (option.children && option.children.length > 0) {\r\n      // Has children, expand to show next column\r\n      setExpandedPath(newPath);\r\n    } else {\r\n      // Leaf node, complete selection\r\n      const newSelectedOptions = getSelectedOptions(newPath);\r\n      if (value === undefined) {\r\n        setInternalValue(newPath);\r\n      }\r\n      onChange?.(newPath, newSelectedOptions);\r\n      setOpen(false);\r\n      setExpandedPath([]);\r\n    }\r\n  };\r\n\r\n  const handleExpand = (option: CascaderOption, columnIndex: number) => {\r\n    if (option.disabled) return;\r\n    const newPath = [...expandedPath.slice(0, columnIndex), option.value];\r\n    setExpandedPath(newPath);\r\n  };\r\n\r\n  const handleClear = (e: React.MouseEvent) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    if (value === undefined) {\r\n      setInternalValue([]);\r\n    }\r\n    onChange?.([], []);\r\n    setExpandedPath([]);\r\n    setOpen(false);\r\n  };\r\n\r\n  const columns = getColumns();\r\n\r\n  // Reset expanded path when opening\r\n  const handleOpenChange = (newOpen: boolean) => {\r\n    setOpen(newOpen);\r\n    if (newOpen) {\r\n      // Initialize expanded path based on current selected value\r\n      setExpandedPath(\r\n        selectedValue.slice(0, -1).length > 0\r\n          ? selectedValue.slice(0, -1)\r\n          : selectedValue\r\n      );\r\n    } else {\r\n      setExpandedPath([]);\r\n    }\r\n  };\r\n\r\n  const displayValue =\r\n    displayLabels.length > 0\r\n      ? displayRender\r\n        ? displayRender(displayLabels, selectedOptions)\r\n        : displayLabels.join(\" / \")\r\n      : null;\r\n\r\n  return (\r\n    <Popover open={open} onOpenChange={handleOpenChange}>\r\n      <PopoverTrigger asChild disabled={disabled}>\r\n        <div\r\n          role=\"combobox\"\r\n          aria-expanded={open}\r\n          aria-disabled={disabled}\r\n          tabIndex={disabled ? -1 : 0}\r\n          className={cn(\r\n            \"inline-flex items-center justify-between gap-2 whitespace-nowrap rounded-md text-sm ring-offset-background transition-colors\",\r\n            \"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\r\n            \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\r\n            \"h-10 px-4 py-2 w-[200px] cursor-pointer\",\r\n            !displayValue && \"text-muted-foreground\",\r\n            disabled && \"pointer-events-none opacity-50\",\r\n            className\r\n          )}\r\n          onKeyDown={(e) => {\r\n            if (e.key === \"Enter\" || e.key === \" \") {\r\n              e.preventDefault();\r\n              if (!disabled) setOpen(!open);\r\n            }\r\n          }}\r\n        >\r\n          <span className=\"truncate flex-1 text-left font-normal\">\r\n            {displayValue || placeholder}\r\n          </span>\r\n          <div className=\"flex items-center gap-1 shrink-0\">\r\n            {allowClear && displayValue && !disabled && (\r\n              <X\r\n                className=\"h-4 w-4 opacity-50 hover:opacity-100 cursor-pointer\"\r\n                onClick={handleClear}\r\n              />\r\n            )}\r\n            <ChevronDown className=\"h-4 w-4 opacity-50\" />\r\n          </div>\r\n        </div>\r\n      </PopoverTrigger>\r\n      <PopoverContent\r\n        className={cn(\"w-auto p-0\", popupClassName)}\r\n        align=\"start\"\r\n      >\r\n        <div className=\"flex\">\r\n          {columns.map((column, columnIndex) => (\r\n            <div\r\n              key={columnIndex}\r\n              className={cn(\r\n                \"min-w-[120px] max-h-[300px] overflow-auto py-1\",\r\n                columnIndex !== columns.length - 1 && \"border-r border-border\"\r\n              )}\r\n            >\r\n              {column.map((option) => {\r\n                const isExpanded = expandedPath[columnIndex] === option.value;\r\n                const isSelected = selectedValue[columnIndex] === option.value;\r\n                const hasChildren =\r\n                  option.children && option.children.length > 0;\r\n\r\n                return (\r\n                  <div\r\n                    key={option.value}\r\n                    className={cn(\r\n                      \"flex items-center justify-between px-3 py-1.5 cursor-pointer text-sm\",\r\n                      \"hover:bg-accent hover:text-accent-foreground\",\r\n                      isSelected && \"bg-accent text-accent-foreground\",\r\n                      isExpanded && \"bg-accent/50\",\r\n                      option.disabled && \"opacity-50 cursor-not-allowed\"\r\n                    )}\r\n                    onClick={() => handleSelect(option, columnIndex)}\r\n                    onMouseEnter={() => {\r\n                      if (expandTrigger === \"hover\" && hasChildren) {\r\n                        handleExpand(option, columnIndex);\r\n                      }\r\n                    }}\r\n                  >\r\n                    <span className=\"truncate\">{option.label}</span>\r\n                    {hasChildren && (\r\n                      <ChevronRight className=\"h-4 w-4 ml-2 shrink-0 opacity-50\" />\r\n                    )}\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </PopoverContent>\r\n    </Popover>\r\n  );\r\n}\r\n",
      "type": "registry:component"
    }
  ]
}